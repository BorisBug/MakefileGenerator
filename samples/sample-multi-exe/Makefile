#-------------------------------------------------->
# makefile autogenerated by python script
# customize it following your own needs <3
#-------------------------------------------------->

# executable(s)
EXEC1 := main
EXEC2 := buffer_test
EXEC3 := memset_test
EXEC4 := canbus_test

# folders
BUILD := build
SOURCE := .

# compiler / linker
CC := gcc

# sources
SRC1 := main.c lib/memset/memset.c lib/canbus/canbus.c lib/buffer/buffer.c
SRC2 := test/buffer_test.c lib/unity/unity.c lib/buffer/buffer.c
SRC3 := test/memset_test.c lib/unity/unity.c lib/memset/memset.c
SRC4 := test/canbus_test.c lib/unity/unity.c lib/canbus/canbus.c lib/buffer/buffer.c

# objects
OBJ1 := $(addprefix $(BUILD)/, $(notdir $(SRC1:%.c=%.o)))
OBJ2 := $(addprefix $(BUILD)/, $(notdir $(SRC2:%.c=%.o)))
OBJ3 := $(addprefix $(BUILD)/, $(notdir $(SRC3:%.c=%.o)))
OBJ4 := $(addprefix $(BUILD)/, $(notdir $(SRC4:%.c=%.o)))
OBJS := $(OBJ1) $(OBJ2) $(OBJ3) $(OBJ4)

# folders to include on compilation time
INCS := $(addprefix -I,$(shell find $(SOURCE) -type f -name "*.h" | xargs dirname | sort | uniq))

# flags for compilation & linking
CFLAGS := -MMD -Wall -Werror -Wpedantic -Wextra
LFLAGS :=

# targets ------------------>

# build all
build: $(BUILD)/$(EXEC1) $(BUILD)/$(EXEC2) $(BUILD)/$(EXEC3) $(BUILD)/$(EXEC4)

# run all
run: build
	@echo '**************************************************'
	@echo 'Running all executables...'
	@echo '**************************************************'
	@./$(BUILD)/$(EXEC1)
	@./$(BUILD)/$(EXEC2)
	@./$(BUILD)/$(EXEC3)
	@./$(BUILD)/$(EXEC4)

# target: main
$(BUILD)/$(EXEC1): $(OBJ1)
	@$(CC) $^ $(LFLAGS) -o $@

# target: buffer_test
$(BUILD)/$(EXEC2): $(OBJ2)
	@$(CC) $^ $(LFLAGS) -o $@

# target: memset_test
$(BUILD)/$(EXEC3): $(OBJ3)
	@$(CC) $^ $(LFLAGS) -o $@

# target: canbus_test
$(BUILD)/$(EXEC4): $(OBJ4)
	@$(CC) $^ $(LFLAGS) -o $@

# target for files inside of '.' (level 0)
$(BUILD)/%.o: ./%.c
	@mkdir -p $(dir $@)
	@$(CC) -c $< -o $@ $(CFLAGS) $(INCS)

# target for files inside of './*' (level 1)
$(BUILD)/%.o: ./*/%.c
	@mkdir -p $(dir $@)
	@$(CC) -c $< -o $@ $(CFLAGS) $(INCS)

# target for files inside of './*/*' (level 2)
$(BUILD)/%.o: ./*/*/%.c
	@mkdir -p $(dir $@)
	@$(CC) -c $< -o $@ $(CFLAGS) $(INCS)

.PHONY: info build run main buffer_test memset_test canbus_test clean

main: $(BUILD)/$(EXEC1)
	@echo '**************************************************'
	@echo 'Running main...'
	@echo '**************************************************'
	@./$(BUILD)/$(EXEC1)

buffer_test: $(BUILD)/$(EXEC2)
	@echo '**************************************************'
	@echo 'Running buffer_test...'
	@echo '**************************************************'
	@./$(BUILD)/$(EXEC2)

memset_test: $(BUILD)/$(EXEC3)
	@echo '**************************************************'
	@echo 'Running memset_test...'
	@echo '**************************************************'
	@./$(BUILD)/$(EXEC3)

canbus_test: $(BUILD)/$(EXEC4)
	@echo '**************************************************'
	@echo 'Running canbus_test...'
	@echo '**************************************************'
	@./$(BUILD)/$(EXEC4)

info:
	@clear
	@echo '******************** Targets *********************'
	@echo 'info: to print this menu'
	@echo 'build: to compile and link all sources (default)'
	@echo 'run: to run all the executables'
	@echo 'main: to run main'
	@echo 'buffer_test: to run buffer_test'
	@echo 'memset_test: to run memset_test'
	@echo 'canbus_test: to run canbus_test'
	@echo 'clean: to remove the build folder'
	@echo '**************************************************'
	@echo ''

clean:
	@rm -rf $(BUILD)

-include $(OBJS:.o=.d)
