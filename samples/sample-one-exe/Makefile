#-------------------------------------------------->
# makefile autogenerated by python script
# customize it following your own needs <3
#-------------------------------------------------->

# compiler / linker
CC := gcc

# flags for compilation & linking
CFLAGS := -Wall -Werror -Wpedantic -Wextra -MMD -MP
LDFLAGS :=

# folders
SRCDIR := .
BUILDDIR := build

# executables
EXEC := $(BUILDDIR)/test/canbus_test

# folders to include on compilation time
INCS := $(addprefix -I,$(shell find $(SRCDIR) -type f -name "*.h" | xargs dirname | sort | uniq))

# source files
SRCS := lib/buffer/buffer.c lib/canbus/canbus.c lib/unity/unity.c \
	test/canbus_test.c

# objects
OBJS := $(SRCS:%.c=$(BUILDDIR)/%.o)

# targets ########################

# build all
build: $(EXEC)

# run all
run: build
	@echo "**************************************************"
	@echo "Running all executables..."
	@echo "**************************************************"
	@echo ""
	@./$(EXEC)

# compile/link: canbus_test
$(EXEC): $(OBJS)
	@$(CC) $^ $(LDFLAGS) -o $@

# targets for each object
$(BUILDDIR)/%.o: %.c
	@mkdir -p $(dir $@)
	@$(CC) -c $< -o $@ $(CFLAGS) $(INCS)

# run: canbus_test
canbus_test: $(EXEC)
	@echo ""
	@echo "**************************************************"
	@echo "Running canbus_test..."
	@echo "**************************************************"
	@echo ""
	@./$(EXEC)

help:
	@clear
	@echo "******************** Targets *********************"
	@echo "help: to print this menu"
	@echo "build: to compile and link all sources (default)"
	@echo "run: to run all the executables"
	@echo "canbus_test: to run canbus_test"
	@echo "clean: to remove the build folder"
	@echo "**************************************************"
	@echo ""

clean:
	@rm -rf $(BUILDDIR)

.PHONY: help build run canbus_test clean

-include $(OBJS:.o=.d)
