#-------------------------------------------------->
# makefile autogenerated by python script
# customize it following your own needs <3
#-------------------------------------------------->

# executable(s)
EXEC := canbus_test

# folders
BUILD := build
SOURCE := .

# compiler / linker
CC := gcc

# sources
SRCS := $(shell find $(SOURCE) -name '*.c')

# objects
OBJS := $(addprefix $(BUILD)/, $(notdir $(SRCS:%.c=%.o)))

# folders to include on compilation time
INCS := $(addprefix -I,$(shell find $(SOURCE) -type f -name "*.h" | xargs dirname | sort | uniq))

# flags for compilation & linking
CFLAGS := -MMD -Wall -Werror -Wpedantic -Wextra
LFLAGS :=

# targets ------------------>

# build all
build: $(BUILD)/$(EXEC)

# run all
run: build
	@echo '**************************************************'
	@echo 'Running all executables...'
	@echo '**************************************************'
	@./$(BUILD)/$(EXEC)

# target: canbus_test
$(BUILD)/$(EXEC): $(OBJS)
	@$(CC) $^ $(LFLAGS) -o $@

# target for files inside of '.' (level 0)
$(BUILD)/%.o: ./%.c
	@mkdir -p $(dir $@)
	@$(CC) -c $< -o $@ $(CFLAGS) $(INCS)

# target for files inside of './*' (level 1)
$(BUILD)/%.o: ./*/%.c
	@mkdir -p $(dir $@)
	@$(CC) -c $< -o $@ $(CFLAGS) $(INCS)

# target for files inside of './*/*' (level 2)
$(BUILD)/%.o: ./*/*/%.c
	@mkdir -p $(dir $@)
	@$(CC) -c $< -o $@ $(CFLAGS) $(INCS)

.PHONY: info build run canbus_test clean

canbus_test: $(BUILD)/$(EXEC)
	@echo '**************************************************'
	@echo 'Running canbus_test...'
	@echo '**************************************************'
	@./$(BUILD)/$(EXEC)

info:
	@clear
	@echo '******************** Targets *********************'
	@echo 'info: to print this menu'
	@echo 'build: to compile and link all sources (default)'
	@echo 'run: to run all the executables'
	@echo 'canbus_test: to run canbus_test'
	@echo 'clean: to remove the build folder'
	@echo '**************************************************'
	@echo ''

clean:
	@rm -rf $(BUILD)

-include $(OBJS:.o=.d)
